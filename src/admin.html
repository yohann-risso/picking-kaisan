<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Admin | Picking Kaisan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap + Chart.js -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <!-- Estilo compartilhado -->
    <link rel="stylesheet" href="../public/css/style.css" />
  </head>

  <body>
    <div class="container py-4">
      <div
        class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3"
      >
        <h1 class="m-0">üìä Painel Administrativo</h1>

        <div class="d-flex gap-2 align-items-center">
          <span id="adminStatus" class="badge text-bg-secondary">üõ∞Ô∏è</span>
          <button id="btnRefresh" class="btn btn-outline-primary btn-sm">
            Atualizar agora
          </button>
        </div>
      </div>

      <!-- FILTROS -->
      <div class="card shadow-sm p-3 mb-4">
        <div class="row g-3 align-items-end">
          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Data in√≠cio</label>
            <input id="dtIni" type="date" class="form-control" />
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Data fim</label>
            <input id="dtFim" type="date" class="form-control" />
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Min itens</label>
            <input
              id="minItens"
              type="number"
              class="form-control"
              value="50"
              min="1"
            />
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Cutoff delta (s)</label>
            <input
              id="cutoff"
              type="number"
              class="form-control"
              value="300"
              min="5"
            />
          </div>

          <div class="col-12 d-flex gap-2 flex-wrap">
            <button id="btnSemana" class="btn btn-sm btn-outline-secondary">
              Semana atual
            </button>
            <button id="btn3dias" class="btn btn-sm btn-outline-secondary">
              √öltimos 3 dias
            </button>
            <button id="btnHoje" class="btn btn-sm btn-outline-secondary">
              Hoje
            </button>

            <div class="ms-auto d-flex gap-2 align-items-center">
              <label
                class="form-check-label small text-muted"
                for="autoRefresh"
              >
                Auto (60s)
              </label>
              <input
                id="autoRefresh"
                class="form-check-input"
                type="checkbox"
                checked
              />
            </div>
          </div>
        </div>
      </div>

      <!-- KPIs topo -->
      <div class="row g-3 mb-4">
        <div class="col-12 col-12 col-md-3">
          <div class="card shadow-sm p-3 text-center">
            <div class="text-muted small">Retiradas (per√≠odo)</div>
            <div id="kpiRetiradas" class="fs-2 fw-bold text-primary">0</div>
          </div>
        </div>
        <div class="col-12 col-12 col-md-3">
          <div class="card shadow-sm p-3 text-center">
            <div class="text-muted small">Operadores ativos</div>
            <div id="kpiOperadores" class="fs-2 fw-bold text-success">0</div>
          </div>
        </div>
        <div class="col-12 col-12 col-md-3">
          <div class="card shadow-sm p-3 text-center">
            <div class="text-muted small">Grupos ativos</div>
            <div id="kpiGrupos" class="fs-2 fw-bold text-danger">0</div>
          </div>
        </div>
        <div class="col-12 col-12 col-md-3">
          <div class="card shadow-sm p-3 text-center">
            <div class="text-muted small">Erros por 1000 itens</div>
            <div id="kpiErrosPorMil" class="fs-2 fw-bold text-warning">-</div>
          </div>
        </div>
      </div>

      <!-- Grupos em execu√ß√£o (hoje) -->
      <div class="card shadow-sm p-3 mb-4">
        <div
          class="d-flex align-items-center justify-content-between flex-wrap gap-2"
        >
          <h5 class="m-0">‚öôÔ∏è Grupos em execu√ß√£o (hoje)</h5>
          <div class="small text-muted">status = RETIRADO ¬∑ grupo != null</div>
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-sm table-hover align-middle">
            <thead>
              <tr>
                <th>Grupo</th>
                <th>Retiradas</th>
                <th>Operadores</th>
                <th>√öltima atividade</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="tblGruposHoje"></tbody>
          </table>
        </div>
      </div>

      <!-- KPI Ideal vs Real (RPC) -->
      <div class="card shadow-sm p-3 mb-4">
        <div
          class="d-flex align-items-center justify-content-between flex-wrap gap-2"
        >
          <h5 class="m-0">
            üèÅ TPS Execu√ß√£o ¬∑ Ideal vs Real (por operador + grupo)
          </h5>
          <div class="small text-muted">
            RPC fn_tempo_ideal_exec_por_periodo
          </div>
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-sm table-hover align-middle">
            <thead>
              <tr>
                <th>Operador</th>
                <th>Grupo</th>
                <th class="text-end">Itens</th>
                <th class="text-end">Real (h)</th>
                <th class="text-end">Ideal p50 (h)</th>
                <th class="text-end">Gap (h)</th>
                <th class="text-end">Fator</th>
                <th class="text-end">p50 (s)</th>
                <th class="text-end">p90 (s)</th>
                <th>Badge</th>
              </tr>
            </thead>
            <tbody id="tblIdealReal"></tbody>
          </table>
        </div>
      </div>

      <!-- Efici√™ncia por operador (per√≠odo) -->
      <div class="card shadow-sm p-3 mb-4">
        <div
          class="d-flex align-items-center justify-content-between flex-wrap gap-2"
        >
          <h5 class="m-0">üéØ Efici√™ncia por Operador (Ideal / Real)</h5>
          <div class="small text-muted">
            RPC fn_eficiencia_por_operador_periodo
          </div>
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-sm table-hover align-middle">
            <thead>
              <tr>
                <th>Operador</th>
                <th class="text-end">Grupos</th>
                <th class="text-end">Itens</th>
                <th class="text-end">TPS real (s)</th>
                <th class="text-end">TPS ideal (s)</th>
                <th class="text-end">Efici√™ncia</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="tblEficienciaOperador"></tbody>
          </table>
        </div>
      </div>

      <!-- Registrar erro por romaneio -->
      <div class="card shadow-sm p-3 mb-4">
        <div
          class="d-flex align-items-center justify-content-between flex-wrap gap-2"
        >
          <h5 class="m-0">üßæ Registrar erro (Expedi√ß√£o)</h5>
          <span class="text-muted small"
            >Erros por romaneio (confer√™ncia final)</span
          >
        </div>

        <form id="formErro" class="row g-2 mt-2">
          <div class="col-12 col-md-2">
            <label class="form-label fw-bold">Romaneio</label>
            <input
              id="erroRomaneio"
              class="form-control"
              placeholder="Ex: 12345"
              required
              list="dlRomaneios"
            />
            <datalist id="dlRomaneios"></datalist>
          </div>

          <div class="col-6 col-md-2">
            <label class="form-label fw-bold">Data</label>
            <input id="erroData" type="date" class="form-control" required />
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Tipo de erro</label>
            <select id="erroTipo" class="form-select" required>
              <option value="">Selecione</option>
              <option>FALTA</option>
              <option>SOBRA</option>
              <option>TROCA_SKU</option>
              <option>TROCA_VARIACAO</option>
              <option>DIVERGENCIA_QTD</option>
              <option>AVARIA</option>
              <option>ETIQUETA/ROMANEIO</option>
              <option>OUTRO</option>
            </select>
          </div>

          <div class="col-6 col-md-2">
            <label class="form-label fw-bold">Quantidade</label>
            <input
              id="erroQtd"
              type="number"
              class="form-control"
              min="1"
              value="1"
              required
            />
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label fw-bold">Conferente</label>
            <input
              id="erroConferente"
              class="form-control"
              placeholder="Nome"
              required
            />
          </div>

          <div class="col-12">
            <label class="form-label fw-bold">Observa√ß√£o (opcional)</label>
            <input
              id="erroObs"
              class="form-control"
              placeholder="Ex: caixa rasgada / etiqueta duplicada..."
            />
          </div>

          <div class="col-12 d-flex gap-2 mt-2">
            <button class="btn btn-primary btn-sm" type="submit">
              Salvar erro
            </button>
            <button
              id="btnCarregarErros"
              class="btn btn-outline-secondary btn-sm"
              type="button"
            >
              Atualizar lista
            </button>
            <span id="erroMsg" class="small text-muted ms-auto"></span>
          </div>
        </form>
      </div>

      <!-- QUALIDADE: charts -->
      <div class="row g-3 mb-4">
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üìà Erros por dia (√∫ltimos 14 dias)</h6>
            <canvas id="chartErrosDia"></canvas>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üìå Pareto de erros por tipo (√∫ltimos 14 dias)</h6>
            <canvas id="chartErrosTipo"></canvas>
          </div>
        </div>
      </div>

      <!-- QUALIDADE: leaderboards -->
      <div class="row g-3 mb-4">
        <div class="col-12 col-lg-4">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üèÖ Leaderboard de erros por Operador (14d)</h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle">
                <thead>
                  <tr>
                    <th>Operador</th>
                    <th class="text-end">Erros</th>
                    <th class="text-end">Eventos</th>
                  </tr>
                </thead>
                <tbody id="tblLbOperador"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üßæ Leaderboard de erros por Conferente (14d)</h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle">
                <thead>
                  <tr>
                    <th>Conferente</th>
                    <th class="text-end">Erros</th>
                    <th class="text-end">Eventos</th>
                  </tr>
                </thead>
                <tbody id="tblLbConferente"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üß© Erros por Tipo (14d)</h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th class="text-end">Erros</th>
                    <th class="text-end">Eventos</th>
                  </tr>
                </thead>
                <tbody id="tblLbTipo"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de erros -->
      <div class="card shadow-sm p-3 mb-4">
        <div
          class="d-flex align-items-center justify-content-between flex-wrap gap-2"
        >
          <h5 class="m-0">üßØ Erros registrados</h5>
          <span class="text-muted small"
            >Filtrado pelo per√≠odo selecionado</span
          >
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-sm table-hover align-middle">
            <thead>
              <tr>
                <th>Data</th>
                <th>Romaneio</th>
                <th>Tipo</th>
                <th>Grupo</th>
                <th>Operador</th>
                <th class="text-end">Qtd</th>
                <th>Conferente</th>
                <th>Obs</th>
              </tr>
            </thead>
            <tbody id="tblErros"></tbody>
          </table>
        </div>
      </div>

      <!-- Charts -->
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">üèÜ Ranking (Fator vs Ideal p50)</h6>
            <canvas id="chartRankingFator"></canvas>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="card shadow-sm p-3">
            <h6 class="mb-3">‚è±Ô∏è Ritmo (p50 vs p90 em segundos)</h6>
            <canvas id="chartRitmo"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./admin.js"></script>
  </body>
</html>
