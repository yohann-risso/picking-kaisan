(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const c={produtos:[],retirados:[],tempoInicio:null,cronometroInterval:null};function x(){return{apikey:void 0,Authorization:"Bearer undefined","Content-Type":"application/json"}}function D(e,t=!1){var i,l;const r=Object.values(e.distribuicaoAtual).reduce((s,m)=>s+m,0),n=((i=e.endereco)==null?void 0:i.split("‚Ä¢")[0])||"SEM LOCAL",o=((l=e.endereco)==null?void 0:l.split("‚Ä¢")[1])||"‚Äî",a=["A","B","C","D"].map(s=>`
    <div class="col minicard">
      <div class="card text-center">
        <div class="card-header fw-bold text-secondary">${s}</div>
        <div class="card-body p-2">
          <h4 class="card-title text-danger m-0">${e.distribuicaoAtual[s]}</h4>
        </div>
      </div>
    </div>`).join(""),d=document.createElement("div");return d.className="col-12 col-md-6 col-lg-4 card-wrapper",d.innerHTML=`
    <div class="card card-produto ${t?"primary":""} h-100 p-3">
      <div class="row g-3">
        <div class="col-md-4 text-center">
          <img src="${e.imagem||""}" alt="${e.descricao||"Produto"}"
               class="img-fluid rounded shadow-sm card-img-produto" style="max-height: 250px;">
        </div>
        <div class="col-md-8">
          <p class="fw-bold fs-3 mb-1 endereco-label">
            ENDERE√áO: <span class="texto-endereco d-block">${n}</span>
          </p>
          <span onclick="zerarEnderecoExterno('${n}')" style="cursor:pointer;" title="Zerar Endere√ßo">
            <i class="bi bi-x-circle-fill text-danger ms-2 fs-5"></i>
            <span class="spinner-border spinner-border-sm text-primary ms-2 d-none"
                  role="status" id="loader-zerar-${n}"></span>
          </span>
          <p><strong>ENDERE√áO SECUND√ÅRIO:</strong><br>${o}</p>
          <p class="text-danger fw-bold fs-2 mb-1">SKU: ${e.sku}</p>
          <p><strong>PRODUTO:</strong> ${e.descricao}</p>
          <p><strong>COLE√á√ÉO:</strong> ${e.colecao||"‚Äî"}</p>
        </div>
      </div>
      <div class="text-center mt-3">
        <div class="fw-bold text-muted small">QTDE TOTAL</div>
        <div class="fw-bold fs-1">${r}</div>
        <div class="row mt-2 g-2">${a}</div>
      </div>
    </div>`,d}function R(e,t){return t>0?Math.round(e/t*100):0}function S(){const e=()=>{const t=new Date(new Date-c.tempoInicio),r=String(t.getUTCHours()).padStart(2,"0"),n=String(t.getUTCMinutes()).padStart(2,"0"),o=String(t.getUTCSeconds()).padStart(2,"0");document.getElementById("cronometro").textContent=`${r}:${n}:${o}`,c.cronometroInterval=setTimeout(e,1e3)};e()}function M(){if(!c.tempoInicio)return"00:00:00";const e=new Date(new Date-c.tempoInicio);return[e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()].map(t=>String(t).padStart(2,"0")).join(":")}function P(){const e=localStorage.getItem("pickingProgresso");if(!e)return;const t=JSON.parse(e);document.getElementById("grupoSalvo").textContent=t.grupo;const r=new bootstrap.Modal(document.getElementById("modalRestaurarPicking"));r.show(),document.getElementById("btnConfirmarRestaurar").onclick=()=>{document.getElementById("grupo").value=t.grupo,document.getElementById("operador").value=t.operador,c.produtos=t.produtos||[],c.retirados=t.retirados||[],c.tempoInicio=t.tempoInicio?new Date(t.tempoInicio):new Date,document.getElementById("grupo").disabled=!0,document.getElementById("operador").disabled=!0,document.getElementById("btnIniciar").classList.add("d-none"),document.getElementById("btnFinalizar").classList.remove("d-none"),document.getElementById("card-tempo").classList.remove("d-none"),S(),E(),r.hide()},document.getElementById("btnCancelarRestaurar").onclick=()=>{localStorage.removeItem("pickingProgresso")}}function $(){var t;const e={grupo:document.getElementById("grupo").value,operador:document.getElementById("operador").value,produtos:c.produtos,retirados:c.retirados,tempoInicio:((t=c.tempoInicio)==null?void 0:t.toISOString())||null};localStorage.setItem("pickingProgresso",JSON.stringify(e))}function I(e,t="info"){const r=t==="success"?"bg-success":t==="error"?"bg-danger":t==="warning"?"bg-warning text-dark":"bg-primary",n=document.getElementById("toast-container");if(!n){console.warn("‚ö†Ô∏è Toast container n√£o encontrado.");return}n.appendChild(o);const o=document.createElement("div");o.className=`toast fade show align-items-center text-white ${r} border-0`,o.innerHTML=`
    <div class="d-flex">
      <div class="toast-body">${e}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>`,document.getElementById("toast-container").appendChild(o),setTimeout(()=>o.remove(),4e3)}function A(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||setTimeout(()=>{I("üì± Para instalar como app: use o menu ‚ãÆ e 'Instalar app'","warning")},3e3)}function U(){window.confetti&&window.confetti({particleCount:250,spread:90,origin:{y:.6}})}function E(){const e=document.getElementById("cards");e.innerHTML="";const t=parseInt(document.getElementById("qtdCards").value,10)||2;c.produtos.slice(0,t).forEach((i,l)=>{const s=D(i,l===0);e.appendChild(s)}),document.getElementById("pendentesList").innerHTML=c.produtos.map(i=>{var l;return`
    <div class="pendente-item">
      <div class="sku">SKU: ${i.sku}</div>
      <div class="descricao">${i.descricao} | Ref: ${i.sku.split("-")[0]}</div>
      <div class="endereco">${(l=i.endereco)==null?void 0:l.split("‚Ä¢")[0]}</div>
    </div>
  `}).join(""),document.getElementById("retiradosList").innerHTML=c.retirados.map(i=>`
    <div class="mb-2">
      ‚úÖ <strong>${i.sku}</strong>
      <span class="badge bg-primary">Grupo ${i.grupo}</span>
      <span class="badge bg-secondary">Caixa ${i.caixa}</span>
      <button
        class="btn btn-sm btn-outline-light ms-3"
        title="Desfazer"
        onclick="desfazerRetirada('${i.sku}', ${i.romaneio}, '${i.caixa}', ${i.grupo})"
      >
        üîÑ
      </button>
    </div>
  `).join("");const n=c.produtos.concat(c.retirados).reduce((i,l)=>{const s=l.distribuicaoAtual||l.distribuicaoOriginal;return i+((s==null?void 0:s.A)||0)+((s==null?void 0:s.B)||0)+((s==null?void 0:s.C)||0)+((s==null?void 0:s.D)||0)},0),o=c.retirados.reduce((i,l)=>{const s=l.distribuicaoOriginal;return i+s.A+s.B+s.C+s.D},0),a=R(o,n),d=document.getElementById("progressoPicking");d.style.width=`${a}%`,d.textContent=`${o}/${n} ‚Ä¢ ${a}%`,a<30?d.className="progress-bar bg-danger":a<70?d.className="progress-bar bg-warning text-dark":d.className="progress-bar bg-success",a===100&&U()}function q(e,t){document.querySelectorAll(".card-produto").forEach(r=>{(!e||r.innerHTML.includes(e))&&(r.classList.add(`feedback-${t}`),setTimeout(()=>r.classList.remove(`feedback-${t}`),800))})}function w(){const e=parseInt(document.getElementById("qtdCards").value,10);document.getElementById("qtdCardsLabel").textContent=e,localStorage.setItem("qtdCardsPreferido",e),E(),$()}function B(e,t="info"){const r=t==="success"?"bg-success":t==="error"?"bg-danger":t==="warning"?"bg-warning text-dark":"bg-primary",n=document.createElement("div");n.className=`toast fade show align-items-center text-white ${r} border-0`,n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.innerHTML=`
    <div class="d-flex">
      <div class="toast-body">${e}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>`;const o=document.getElementById("toast-container");o&&(o.appendChild(n),setTimeout(()=>n.remove(),4e3))}async function T(){const t=await(await fetch("/api/proxy?endpoint=/rest/v1/produtos?select=grupo")).json(),r=[...new Set(t.map(n=>parseInt(n.grupo)))].sort((n,o)=>n-o);document.getElementById("grupo").innerHTML=r.map(n=>`<option value="${n}">${n}</option>`).join("")}async function O(){const e=x(),t=[],r=1e3;let n=0;for(;;){const a=await(await fetch("/api/proxy?endpoint=/rest/v1/produtos_ref?select=sku,imagem,colecao",{headers:{...e,Range:`${n}-${n+r-1}`}})).json();if(t.push(...a),a.length<r)break;n+=r}window.mapaRefGlobal=new Map(t.map(o=>[o.sku.trim().toUpperCase(),o]))}async function N(e,t,r,n){new Date().toLocaleString("sv-SE",{timeZone:"America/Sao_Paulo"}).replace(" ","T"),e.sku,e.romaneio}console.log("üì§ Enviando retirada:",payload);async function z(e){await fetch("/api/proxy?endpoint=/rest/v1/retiradas",{method:"POST",headers:x(),body:JSON.stringify(e)})}z(payload);async function h(){var n;console.log("‚öôÔ∏è carregarProdutos chamado");const e=document.getElementById("grupo").value,t=document.getElementById("operador").value;if(!e||!t)return B("Preencha grupo e operador","warning");document.getElementById("grupo").disabled=!0,document.getElementById("operador").disabled=!0,document.getElementById("btnIniciar").classList.add("d-none"),document.getElementById("btnFinalizar").classList.remove("d-none"),document.getElementById("card-tempo").classList.remove("d-none");const r=x();try{const a=await(await fetch(`/api/proxy?endpoint=/rest/v1/produtos?grupo=eq.${e}&select=*`,{headers:r})).json(),d=window.mapaRefGlobal||new Map,l=await(await fetch(`/api/proxy?endpoint=/rest/v1/retiradas?grupo=eq.${e}&select=sku,caixa`,{headers:r})).json(),s=new Map(l.map(u=>[u.sku.trim().toUpperCase(),u.caixa]));c.produtos=[],c.retirados=[];const m={};for(const u of a){const g=(u.sku||"").trim().toUpperCase(),p=(u.caixa||"").toUpperCase(),f=parseInt(u.qtd||0,10),L=((n=(u.endereco||"").split("‚Ä¢")[0])==null?void 0:n.trim())||"SEM ENDERE√áO",v=d.get(g);if(!m[g]){const k=/A(\d+)-B(\d+)-R(\d+)-C(\d+)-N(\d+)/.exec(L);m[g]={...u,sku:g,endereco:L,imagem:(v==null?void 0:v.imagem)||"",colecao:(v==null?void 0:v.colecao)||"‚Äî",distribuicaoAtual:{A:0,B:0,C:0,D:0},distribuicaoOriginal:{A:0,B:0,C:0,D:0},ordemEndereco:k?k.slice(1).map(Number):[999,999,999,999,999]}}const b=m[g];p==="A"&&(b.distribuicaoAtual.A+=f,b.distribuicaoOriginal.A+=f),p==="B"&&(b.distribuicaoAtual.B+=f,b.distribuicaoOriginal.B+=f),p==="C"&&(b.distribuicaoAtual.C+=f,b.distribuicaoOriginal.C+=f),p==="D"&&(b.distribuicaoAtual.D+=f,b.distribuicaoOriginal.D+=f)}for(const u of Object.values(m))s.has(u.sku)?(u.caixa=s.get(u.sku),c.retirados.push(u)):c.produtos.push(u);c.produtos.sort((u,g)=>{for(let p=0;p<u.ordemEndereco.length;p++)if(u.ordemEndereco[p]!==g.ordemEndereco[p])return u.ordemEndereco[p]-g.ordemEndereco[p];return 0}),c.tempoInicio=new Date,S(),E(),$()}catch(o){console.error("‚ùå Erro ao carregar produtos:",o),B("Erro ao carregar dados do Supabase","error")}}function j(){const e=["Alan Ramos","Anderson Dutra","Arthur Oliveira","Felipe Moraes","Filipe Silva","Gabriel Lagoa","Jo√£o Alves","Kaique Teixeira","Marrony Portugal","Nalbert Pereira","Rodrigo Novaes","Rony C√¥rrea","Ykaro Oliveira","Yohann Risso"];document.getElementById("operador").innerHTML=e.map(t=>`<option value="${t}">${t}</option>`).join("")}async function y(){const e=document.getElementById("skuInput"),t=e.value.trim().toUpperCase(),r=document.getElementById("grupo").value;document.getElementById("operador").value,e.disabled=!0,document.querySelector(".input-group .btn").disabled=!0;const n=()=>{e.value="",e.disabled=!1,document.querySelector(".input-group .btn").disabled=!1,e.focus()},o=c.produtos.findIndex(s=>s.sku.toUpperCase()===t||(s.ean||"").toUpperCase()===t);if(o===-1)return I("Produto n√£o encontrado","error"),n();const a=c.produtos[o],d=a.distribuicaoAtual;let i="";if(d.A>0?(d.A--,i="A"):d.B>0?(d.B--,i="B"):d.C>0?(d.C--,i="C"):d.D>0&&(d.D--,i="D"),!i)return I("Produto sem caixa para retirar","error"),n();await N(a),d.A+d.B+d.C+d.D===0&&(c.retirados.unshift({...a,caixa:i,grupo:r,distribuicaoOriginal:{...a.distribuicaoOriginal}}),c.produtos.splice(o,1)),q(a.sku,"success"),E(),$(),n()}function C(){clearTimeout(c.cronometroInterval);const e=document.getElementById("operador").value,t=document.getElementById("grupo").value,r={operador:e,grupo:t,tempoExecucao:M(),retirados:c.retirados};H(r),localStorage.removeItem("pickingProgresso"),c.produtos=[],c.retirados=[],c.tempoInicio=null,document.getElementById("grupo").disabled=!1,document.getElementById("operador").disabled=!1,document.getElementById("btnIniciar").classList.remove("d-none"),document.getElementById("btnFinalizar").classList.add("d-none"),document.getElementById("cards").innerHTML="",document.getElementById("pendentesList").innerHTML="",document.getElementById("retiradosList").innerHTML="",document.getElementById("cronometro").textContent="00:00:00",document.getElementById("ideal").textContent="",document.getElementById("progressoPicking").style.width="0%",document.getElementById("progressoPicking").textContent="0%",B("Pronto para iniciar novo picking! üöÄ","success")}function H(e){const{jsPDF:t}=window.jspdf,r=new t;r.setFont("helvetica","bold"),r.setFontSize(16),r.text("üì¶ Resumo de Picking",20,20),r.setFont("helvetica","normal"),r.setFontSize(12),r.text(`Operador: ${e.operador}`,20,35),r.text(`Grupo: ${e.grupo}`,20,42),r.text(`Tempo: ${e.tempoExecucao}`,20,49),r.text(`Data: ${new Date().toLocaleString()}`,20,56),r.text("‚úÖ Retirados:",20,70),e.retirados.forEach((n,o)=>{r.text(`${o+1}. SKU: ${n.sku} | Produto: ${n.descricao||"-"} | Caixa: ${n.caixa}`,20,80+o*7)}),r.save(`Picking_Grupo${e.grupo}_${e.operador}.pdf`)}window.addEventListener("load",async()=>{var a,d,i,l,s;console.log("‚úÖ window.onload: DOM e assets carregados");const e=document.getElementById("btnIniciar");console.log("üîç btnIniciar:",e),e==null||e.addEventListener("click",()=>{console.log("üñ±Ô∏è Clique no bot√£o 'Iniciar'"),h()});const t=document.getElementById("btnConfirmarSKU");t==null||t.addEventListener("click",()=>{console.log("üñ±Ô∏è Clique em Confirmar SKU"),y()});const r=document.getElementById("btnFinalizar");r==null||r.addEventListener("click",()=>{console.log("üõë Clique em Finalizar"),C()});const n=document.getElementById("skuInput");n==null||n.addEventListener("keydown",m=>{m.key==="Enter"&&(console.log("‚å®Ô∏è Enter pressionado no SKU"),y())});const o=document.getElementById("qtdCards");o==null||o.addEventListener("input",()=>{console.log("üéöÔ∏è Alterou quantidade de cards"),w()});try{window.env={SUPABASE_URL:void 0,GAS_ZERAR_URL:void 0},j(),await T(),await O(),P(),A(),(a=document.getElementById("btnIniciar"))==null||a.addEventListener("click",()=>{console.log("üñ±Ô∏è Clique no bot√£o 'Iniciar'"),h()}),(d=document.getElementById("btnFinalizar"))==null||d.addEventListener("click",C),(i=document.getElementById("btnConfirmarSKU"))==null||i.addEventListener("click",y),(l=document.getElementById("skuInput"))==null||l.addEventListener("keydown",m=>{m.key==="Enter"&&y()}),(s=document.getElementById("qtdCards"))==null||s.addEventListener("input",w)}catch(m){console.error("‚ùå Erro ao carregar aplica√ß√£o:",m)}console.log("Main carregado ‚úÖ")});window.carregarProdutos=h;window.biparProduto=y;window.finalizarPicking=C;window.atualizarQtdCards=w;window.carregarGrupos=T;window.carregarTodosRefs=O;window.restaurarCacheLocal=P;window.checarModoStandalone=A;console.log("Exportando fun√ß√µes para o console global ‚úÖ");console.log("üåü Bem-vindo ao sistema de Picking! Carregando...");
